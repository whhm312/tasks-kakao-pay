<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="me.kakao.pay.luck.mapper.LuckDBMapper">

<!-- 
	<select id="listMap" resultType="com.example.map.prac.dto.MapDto">
		select * from tbl_map
	</select>
 -->

	<select id="selectNow" resultType="string">
		SELECT DATE_FORMAT(NOW() , '%Y-%m-%d') AS NOW
	</select>
  
	<insert id="insertLuck" parameterType="me.kakao.pay.common.domain.Luck">
		INSERT INTO TBL_LUCK (
			BLESSER_ID, ROOM_ID, 
			AMOUNT, MAX_GRABBER_COUNT, 
			BLESSING_DATE, TOKEN
		) VALUES (
			#{blesserId}, #{roomId}, 
			#{amount}, #{maxGrabberCount}, 
			NOW(), #{token}
		)
	</insert>
	
	<select id="countSameToken" parameterType="me.kakao.pay.common.domain.Luck" resultType="int">
		SELECT COUNT(*) 
		  FROM TBL_LUCK 
		 WHERE TOKEN = #{token}
		   AND BLESSER_ID = #{blesserId}
		   AND ROOM_ID = #{roomId}
		   AND BLESSING_DATE >= (CURDATE() - INTERVAL 7 DAY)
	</select>
</mapper>